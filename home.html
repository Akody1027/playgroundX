<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>playgroundX | Production</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDFmhk3ybnsVsFenCE3xvdmy5y_4u9ss7o&libraries=places&callback=initGoogle" async defer></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, collection, doc, setDoc, getDocs, addDoc, query, orderBy, onSnapshot, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDFmhk3ybnsVsFenCE3xvdmy5y_4u9ss7o", 
        authDomain: "playgroundx-ca021.firebaseapp.com",
        projectId: "playgroundx-ca021",
        storageBucket: "playgroundx-ca021.firebasestorage.app",
        messagingSenderId: "427340828971",
        appId: "1:427340828971:web:1d9e2dc22ecd69593eb56e",
        measurementId: "G-NEV8FYG0WK"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      window.db = db;
      window.fbase = { collection, doc, setDoc, getDocs, addDoc, query, orderBy, onSnapshot, limit, serverTimestamp };
      console.log("Firebase Tools Ready âœ…");
    </script>
</head>
<body>

<div id="header">
    <div style="display: flex; align-items: center;" onclick="location.reload()">
        <div style="background: var(--accent); color: white; width: 35px; height: 35px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; margin-right: 10px;">X</div>
        <h1 style="color: white; margin: 0; font-size: 20px;">playground<span style="color: var(--accent);">X</span></h1>
    </div>
    <div class="header-icons">
        <div onclick="window.switchView('game', null)" style="cursor: pointer; display: flex; align-items: center;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"></rect><path d="M6 12h4m-2-2v4"></path><circle cx="17" cy="11" r="1"></circle><circle cx="15" cy="13" r="1"></circle></svg>
        </div>
        <div class="msg-icon-wrapper" onclick="window.openMsgModal()">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
            <span class="badge" id="msg-badge" style="display:none">0</span>
        </div>
        <div id="user-icon-trigger" onclick="window.toggleUserMenu()" style="width: 40px; height: 40px; background: #222; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #444;">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        </div>
    </div>
    <div id="user-dropdown">
        <a href="#" id="open-my-profile" onclick="window.openMyProfile()">My Profile</a>
        <a href="#" style="color: var(--accent);" onclick="location.reload()">Log Out</a>
    </div>
</div>

<div class="vertical-toolbar">
    <button class="view-btn active" onclick="window.switchView('swipe', this)">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line></svg>
    </button>
    <button class="view-btn" onclick="window.switchView('grid', this)">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
    </button>
    <button class="view-btn" onclick="window.switchView('map', this)">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
    </button>
    
    <div style="height: 20px;"></div> <button class="view-btn" onclick="document.getElementById('filter-modal').style.display='block'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line></svg>
    </button>
</div>

<div id="view-swipe" class="app-view active fade-in">
    <div id="swipe-zone">
        </div>
    <div class="fixed-actions">
        <button id="btn-reject" class="swipe-btn" onclick="window.userSwipe('left')">âœ˜</button>
        <div style="position:relative">
            <span class="wink-feedback" id="wink-txt">Wink sent!</span>
            <button id="btn-like" class="swipe-btn" style="border-color:var(--accent);color:var(--btnfont)" onclick="window.userSwipe('right')">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M8 15a6 6 0 0 0 8 0"></path><line x1="9" y1="9" x2="9.01" y2="9" stroke-width="3"></line><path d="M15 9h2"></path></svg>
            </button>
        </div>
    </div>
</div>

<div id="view-grid" class="app-view fade-in" style="padding-left: 60px;"> <div class="grid-container" id="grid-content"></div>
</div>

<div id="view-map" class="app-view fade-in">
    <div id="map"></div>
</div>

<div id="view-game" class="app-view fade-in">
    <h2 style="color:var(--accent); margin-bottom: 5px; text-align: center;">Neon Pong</h2>
    <p style="color:#666; font-size:12px; margin-bottom:15px; text-align: center;">Drag to move paddle.</p>
    <canvas id="game-canvas" width="300" height="400"></canvas>
    <div style="display:flex; justify-content:center; gap:10px; margin-top:10px;">
        <button onclick="window.initGame()" style="background:var(--accent); color:white; border:none; padding:8px 15px; border-radius:10px;">Start Game</button>
    </div>
</div>

<div id="profile-modal" class="modal fade-in">
    <div class="modal-header">
        <button class="back-arrow-btn" onclick="document.getElementById('profile-modal').style.display='none'">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
        </button>
        <h2 style="font-size: 18px; margin: 0; color: white;">Edit Profile</h2>
        <button onclick="window.saveProfile()" style="background: none; border: none; color: var(--accent); font-weight: bold;">Save</button>
    </div>
    <div style="padding: 20px; max-width: 500px; margin: 0 auto;">
        
        <div style="text-align: center; margin-bottom: 20px;">
             <span id="swipe-counter" style="background:#222; padding:5px 10px; border-radius:15px; font-size:12px; color:var(--accent);">ðŸ“Š 0 Swipes Today</span>
        </div>

        <div><label class="filter-label" style="margin-top:0;">DISPLAY NAME</label><input type="text" id="p-alias" class="style-input" placeholder="e.g. Jay_Rocker"></div>

        <div style="text-align: center; margin: 20px 0;">
            <div style="position: relative; width: 120px; height: 120px; margin: 0 auto;">
                <img id="my-main-preview" src="https://via.placeholder.com/120" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent);">
                <label for="main-up" style="position: absolute; bottom: 0; right: 0; background: var(--accent); width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 3px solid #000; color: white; font-size: 22px; font-weight: bold;">+</label>
                <input type="file" id="main-up" hidden onchange="window.previewMainAndGallery(event)">
            </div>
        </div>

        <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 50px;">
            <div><label class="filter-label" style="margin-top:0;">BIO</label><textarea id="p-bio" style="width: 100%; background: #111; border: 1px solid #333; padding: 12px; border-radius: 10px; color: white;"></textarea></div>

            <div id="loc-manual" class="accordion-content" style="display:block;">
                <label class="filter-label">LOCATION</label>
                <input type="text" id="google-loc-input" class="style-input" placeholder="Enter City (Google Maps)...">
            </div>

            <label class="filter-label">VICES</label>
            <div class="toggle-row"><span>Smoker</span><input type="checkbox" id="p-smoker" class="toggle-checkbox"><label for="p-smoker" class="toggle-switch"></label></div>
            <div class="toggle-row"><span>Drinker</span><input type="checkbox" id="p-drinker" class="toggle-checkbox"><label for="p-drinker" class="toggle-switch"></label></div>

            <label class="filter-label">FAMILY</label>
            <div class="toggle-row"><span>Has Children</span><input type="checkbox" id="p-kids" class="toggle-checkbox"><label for="p-kids" class="toggle-switch"></label></div>
            <div class="toggle-row"><span>Wants Children</span><input type="checkbox" id="p-wants-kids" class="toggle-checkbox"><label for="p-wants-kids" class="toggle-switch"></label></div>

            <label class="filter-label">ZODIAC</label>
            <select id="p-zodiac" class="style-input">
                <option value="Aries">Aries</option><option value="Taurus">Taurus</option><option value="Gemini">Gemini</option>
                <option value="Cancer">Cancer</option><option value="Leo">Leo</option><option value="Virgo">Virgo</option>
                <option value="Libra">Libra</option><option value="Scorpio">Scorpio</option><option value="Sagittarius">Sagittarius</option>
                <option value="Capricorn">Capricorn</option><option value="Aquarius">Aquarius</option><option value="Pisces">Pisces</option>
            </select>

            <label class="filter-label">LOVE LANGUAGES (Select Multiple)</label>
            <div class="toggle-row" onclick="window.toggleProfileAcc('acc-love')">
                <span id="disp-love">Select...</span><span style="color:#666;">â–¼</span>
            </div>
            <div id="acc-love" class="accordion-content">
                <label class="checkbox-option"><input type="checkbox" value="Words"> Words of Affirmation</label>
                <label class="checkbox-option"><input type="checkbox" value="Acts"> Acts of Service</label>
                <label class="checkbox-option"><input type="checkbox" value="Gifts"> Receiving Gifts</label>
                <label class="checkbox-option"><input type="checkbox" value="Time"> Quality Time</label>
                <label class="checkbox-option"><input type="checkbox" value="Touch"> Physical Touch</label>
            </div>
        </div>
    </div>
</div>

<div id="filter-modal" class="modal fade-in" style="background: rgba(0,0,0,0.9);">
    <div class="filter-content" style="background: #1A1A1A; width: 85%; max-width: 400px; height: 100%; float: right; padding: 30px; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
            <h2 style="margin: 0;">Refine Search</h2>
            <button onclick="document.getElementById('filter-modal').style.display='none'" style="background: none; border: none; color: white; font-size: 24px;">âœ•</button>
        </div>
        
        <label class="filter-label">I'M LOOKING FOR</label>
        <div class="toggle-row"><span>Men</span><input type="checkbox" id="f-men" class="toggle-checkbox" checked><label for="f-men" class="toggle-switch"></label></div>
        <div class="toggle-row"><span>Women</span><input type="checkbox" id="f-women" class="toggle-checkbox" checked><label for="f-women" class="toggle-switch"></label></div>
        
        <label class="filter-label">AGE RANGE</label>
        <div style="display:flex; gap:10px;">
            <input type="number" id="f-min-age" class="style-input" value="18" placeholder="Min">
            <input type="number" id="f-max-age" class="style-input" value="99" placeholder="Max">
        </div>

        <label class="filter-label">DISTANCE: <span id="dist-val" style="color:var(--accent)">50 mi</span></label>
        <input type="range" id="f-dist" min="1" max="100" value="50" oninput="document.getElementById('dist-val').innerText = this.value + ' mi'" style="accent-color: var(--accent); width: 100%;">

        <label class="filter-label">DEAL BREAKERS (Check to Exclude)</label>
        <div class="toggle-row"><span>No Smokers</span><input type="checkbox" id="f-no-smoke" class="toggle-checkbox"><label for="f-no-smoke" class="toggle-switch"></label></div>
        <div class="toggle-row"><span>No Drinkers</span><input type="checkbox" id="f-no-drink" class="toggle-checkbox"><label for="f-no-drink" class="toggle-switch"></label></div>
        <div class="toggle-row"><span>No Kids</span><input type="checkbox" id="f-no-kids" class="toggle-checkbox"><label for="f-no-kids" class="toggle-switch"></label></div>

        <button onclick="window.applyFilters()" style="width:100%; background: var(--accent); padding: 15px; border-radius: 12px; border:none; color:white; font-weight:bold; margin-top: 20px;">Apply Filters</button>
    </div>
</div>

<div id="view-user-modal" class="modal fade-in">
    <div class="modal-header">
        <button class="back-arrow-btn" onclick="document.getElementById('view-user-modal').style.display='none'">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
        </button>
        <h2 style="font-size: 18px; margin: 0; color: white;">User Profile</h2>
    </div>
    <div style="padding: 20px;">
        <img id="vu-img" src="" style="width:100%; height:350px; object-fit:cover; border-radius:20px;">
        <h1 id="vu-name" style="color:var(--accent); margin-top:15px;">Name</h1>
        <div id="vu-tags" style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;"></div>
        <p id="vu-bio" style="color:#ccc; margin-top:20px;">Bio...</p>
    </div>
</div>

<div id="confirm-modal" style="display:none !important;"> 
    <div class="confirm-box">
        <h3 style="color:white; margin-top:0;">Delete Item?</h3>
        <p style="color:#aaa; font-size:14px;">Are you sure? This cannot be undone.</p>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn-no" onclick="window.closeConfirm()">No</button>
            <button class="btn-yes" onclick="window.confirmYes()">Yes, Delete</button>
        </div>
    </div>
</div>

<div id="save-modal" style="display:none !important;"> 
    <div class="confirm-box">
        <div style="color:var(--accent); font-size:40px;">âœ“</div>
        <h3 style="color:white; margin-top:10px;">Profile Saved</h3>
        <p style="color:#aaa; font-size:14px;">Your changes are now live.</p>
        <button class="btn-ok" onclick="document.getElementById('save-modal').style.display='none'">Awesome</button>
    </div>
</div>

<div id="msg-modal" class="modal fade-in">
    <div class="modal-header">
        <button class="back-arrow-btn" onclick="document.getElementById('msg-modal').style.display='none'"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"></line></svg></button>
        <h2>Messages</h2>
        <div></div>
    </div>
    <div style="padding:20px; text-align:center; color:#666;">No new messages.</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="script.js" defer></script>
</body>
</html>
