<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>God Mode Admin | PlaygroundX</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- 1. CORE STYLES (MATCHING YOUR APP) --- */
        :root {
            --accent: #8B5CF6; 
            --accent-dark: #7C3AED;
            --bg-dark: #121212;
            --card-dark: #1E1E1E;
            --text-main: #E5E7EB;
            --danger: #EF4444;
            --warning: #F59E0B;
            --success: #10B981;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0; padding: 0;
            overflow-x: hidden;
        }

        /* --- 2. ADMIN GOD BUTTON --- */
        #admin-entry-btn {
            position: fixed; bottom: 20px; right: 20px;
            background: var(--danger); color: white;
            width: 60px; height: 60px; border-radius: 50%;
            border: none; font-weight: 900; font-size: 14px;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
            cursor: pointer; z-index: 9999;
            transition: transform 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        #admin-entry-btn:hover { transform: scale(1.1); }

        /* --- 3. MAIN ADMIN PANEL MODAL --- */
        #god-mode-panel {
            display: none; position: fixed; inset: 0;
            background: #000; z-index: 10000;
            display: flex; flex-direction: column;
        }

        /* Sidebar & Layout */
        .admin-layout { display: flex; height: 100vh; width: 100%; }
        
        .admin-sidebar {
            width: 250px; background: #161616; border-right: 1px solid #333;
            display: flex; flex-direction: column; padding: 20px;
        }
        
        .admin-content {
            flex: 1; padding: 30px; overflow-y: auto; background: #0f0f0f;
        }

        /* Navigation Tabs */
        .admin-nav-item {
            padding: 15px; margin-bottom: 5px; cursor: pointer;
            border-radius: 8px; font-weight: 600; color: #888;
            transition: 0.2s; display: flex; align-items: center; gap: 10px;
        }
        .admin-nav-item:hover { background: #222; color: white; }
        .admin-nav-item.active { background: var(--accent); color: white; }

        /* Section Cards */
        .admin-card {
            background: #1E1E1E; border: 1px solid #333;
            border-radius: 12px; padding: 20px; margin-bottom: 20px;
        }
        
        .card-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 15px;
        }
        .card-title { font-size: 18px; font-weight: bold; margin: 0; color: white; }

        /* Inputs & Buttons */
        .admin-input {
            width: 100%; background: #111; border: 1px solid #444;
            padding: 10px; border-radius: 6px; color: white; margin-bottom: 10px;
        }
        .admin-btn {
            padding: 10px 20px; border-radius: 6px; border: none;
            font-weight: bold; cursor: pointer; font-size: 12px;
            display: inline-flex; align-items: center; gap: 6px;
        }
        .btn-danger { background: var(--danger); color: white; }
        .btn-accent { background: var(--accent); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-ghost { background: #333; color: white; }

        /* --- 4. VERIFICATION QUEUE STYLES --- */
        .verify-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .evidence-box {
            background: #000; border: 1px solid #333; border-radius: 8px;
            height: 250px; display: flex; align-items: center; justify-content: center;
            overflow: hidden; position: relative;
        }
        .evidence-box img { width: 100%; height: 100%; object-fit: contain; }
        .evidence-label {
            position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7);
            padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold;
        }

        /* --- 5. USER LIST & WARNINGS --- */
        .user-row {
            display: flex; align-items: center; justify-content: space-between;
            background: #111; padding: 10px; border-radius: 8px; margin-bottom: 5px;
            border: 1px solid #222;
        }
        .warning-tag {
            color: var(--warning); font-weight: bold; display: flex; align-items: center; gap: 5px;
            background: rgba(245, 158, 11, 0.1); padding: 2px 6px; border-radius: 4px; font-size: 11px;
        }

        /* --- 6. CRAWLER LOGS --- */
        .crawler-log {
            font-family: monospace; font-size: 12px; color: #aaa;
            max-height: 150px; overflow-y: auto; background: #000; padding: 10px;
            border: 1px solid #333; border-radius: 6px; margin-top: 10px;
        }
        .log-hit { color: var(--danger); display: block; margin-bottom: 2px; }

        /* --- 7. MIRROR / MODAL OVERLAYS --- */
        .admin-modal-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            z-index: 20000; align-items: center; justify-content: center;
        }
        .confirm-box {
            background: #1E1E1E; padding: 25px; border-radius: 12px; width: 300px;
            text-align: center; border: 1px solid #444; box-shadow: 0 10px 30px black;
        }

        /* Stream Thumbnails */
        .stream-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
        .stream-thumb { position: relative; aspect-ratio: 9/16; background: #000; border-radius: 8px; overflow: hidden; }
        .kill-btn {
            position: absolute; top: 5px; right: 5px; background: red; color: white;
            width: 24px; height: 24px; border-radius: 50%; border: none; cursor: pointer;
        }

    </style>
</head>
<body>

    <div id="admin-root">
        
        <button id="admin-entry-btn" onclick="window.admin.togglePanel()" style="display:none;">GOD</button>

        <div id="god-mode-panel" style="display:none;">
            <div class="admin-layout">
                
                <div class="admin-sidebar">
                    <h3 style="color:white; margin:0 0 20px 0;">GOD MODE <span style="font-size:10px; color:var(--danger)">v2.0</span></h3>
                    
                    <div class="admin-nav-item active" onclick="window.admin.switchTab('verify')">
                        <span>üõ°Ô∏è</span> Verification <span id="pending-badge" style="background:var(--danger); font-size:10px; padding:2px 6px; border-radius:10px;">0</span>
                    </div>
                    <div class="admin-nav-item" onclick="window.admin.switchTab('users')">
                        <span>üë•</span> Users
                    </div>
                    <div class="admin-nav-item" onclick="window.admin.switchTab('economy')">
                        <span>üí∞</span> Economy
                    </div>
                    <div class="admin-nav-item" onclick="window.admin.switchTab('content')">
                        <span>üì∫</span> Content Policing
                    </div>
                    <div class="admin-nav-item" onclick="window.admin.switchTab('crawler')">
                        <span>üï∑Ô∏è</span> Crawler
                    </div>
                    <div class="admin-nav-item" onclick="window.admin.switchTab('system')">
                        <span>üö®</span> System
                    </div>

                    <div style="margin-top:auto">
                        <button class="admin-btn btn-ghost" style="width:100%" onclick="window.admin.togglePanel()">Exit Panel</button>
                    </div>
                </div>

                <div class="admin-content">

                    <div id="tab-verify" class="admin-tab">
                        <div class="card-header"><h2 class="card-title">Verification Center</h2></div>
                        <div id="verify-queue-container">
                            <p style="color:#666">Checking queue...</p>
                        </div>
                    </div>

                    <div id="tab-users" class="admin-tab" style="display:none;">
                        <div class="card-header">
                            <h2 class="card-title">User Management</h2>
                            <input type="text" id="user-search" class="admin-input" style="width:200px; margin:0;" placeholder="Search Alias or UID..." onkeyup="window.admin.searchUsers()">
                        </div>
                        <div id="users-list-container"></div>
                    </div>

                    <div id="tab-economy" class="admin-tab" style="display:none;">
                        <div class="admin-card">
                            <div class="card-header"><h3 class="card-title">God Wallet</h3></div>
                            <p>Admin Balance: <span style="color:var(--warning); font-weight:bold;">‚àû</span></p>
                            <button class="admin-btn btn-success" onclick="alert('Wallet reset to Infinity.')">Reset Balance</button>
                        </div>

                        <div class="admin-card">
                            <div class="card-header"><h3 class="card-title">Robin Hood Mode</h3></div>
                            <input type="text" id="robin-target" class="admin-input" placeholder="Paste User UID">
                            <div style="display:flex; gap:10px;">
                                <button class="admin-btn btn-success" onclick="window.admin.modCoins('add')">Add 100 Coins</button>
                                <button class="admin-btn btn-danger" onclick="window.admin.modCoins('remove')">Remove 100 Coins</button>
                            </div>
                        </div>
                    </div>

                    <div id="tab-content" class="admin-tab" style="display:none;">
                        <div class="admin-card">
                            <div class="card-header"><h3 class="card-title">Live Stream Monitor</h3></div>
                            <div id="stream-monitor-grid" class="stream-grid">
                                </div>
                        </div>
                        
                        <div class="admin-card" style="border-color:var(--danger);">
                            <div class="card-header"><h3 class="card-title" style="color:var(--danger)">Nuclear Options</h3></div>
                            <div style="display:flex; gap:10px;">
                                <button class="admin-btn btn-danger" onclick="window.admin.nukeChat()">‚ò¢Ô∏è NUKE PUBLIC CHAT</button>
                                <button class="admin-btn btn-danger" onclick="window.admin.flushBots()">ü§ñ FLUSH BOTS</button>
                            </div>
                        </div>
                    </div>

                    <div id="tab-crawler" class="admin-tab" style="display:none;">
                        <div class="admin-card">
                            <div class="card-header">
                                <h3 class="card-title">Public Data Crawler</h3>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <span style="font-size:12px; color:#888;">AUTO-RUN</span>
                                    <input type="checkbox" id="crawler-toggle" onchange="window.admin.toggleAutoCrawler(this)">
                                </div>
                            </div>
                            <p style="font-size:12px; color:#888; margin-bottom:10px;">
                                Scans <strong>Public Bios</strong> and <strong>Aliases</strong> only. Ignores private chats.<br>
                                Targets: Illegal keywords, Phone Numbers, Social Links.
                            </p>
                            <button class="admin-btn btn-accent" onclick="window.admin.runCrawlerOnce()">RUN SCAN NOW</button>
                            
                            <div id="crawler-output" class="crawler-log">
                                System Ready. Waiting for scan...
                            </div>
                        </div>
                    </div>

                    <div id="tab-system" class="admin-tab" style="display:none;">
                        <div class="admin-card">
                            <div class="card-header"><h3 class="card-title">System Controls</h3></div>
                            <div style="margin-bottom:20px;">
                                <label style="display:flex; align-items:center; gap:10px; font-weight:bold;">
                                    MAINTENANCE MODE
                                    <input type="checkbox" id="maint-toggle" onchange="window.admin.toggleMaintenance()">
                                </label>
                            </div>
                            <input type="text" id="broadcast-msg" class="admin-input" placeholder="Broadcast Message...">
                            <button class="admin-btn btn-accent" onclick="window.admin.sendBroadcast()">SEND GLOBAL ALERT</button>
                        </div>
                        <div class="admin-card">
                            <div class="card-header"><h3 class="card-title">Analytics</h3></div>
                            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; text-align:center;">
                                <div style="background:#111; padding:10px; border-radius:8px;">
                                    <div style="font-size:24px; font-weight:bold; color:var(--accent);">1,240</div>
                                    <div style="font-size:10px; color:#666;">USERS</div>
                                </div>
                                <div style="background:#111; padding:10px; border-radius:8px;">
                                    <div style="font-size:24px; font-weight:bold; color:var(--success);">$4,200</div>
                                    <div style="font-size:10px; color:#666;">REVENUE</div>
                                </div>
                                <div style="background:#111; padding:10px; border-radius:8px;">
                                    <div style="font-size:24px; font-weight:bold; color:var(--danger);">3</div>
                                    <div style="font-size:10px; color:#666;">REPORTS</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div id="admin-confirm-modal" class="admin-modal-overlay">
            <div class="confirm-box">
                <h3 style="color:white; margin-top:0;" id="conf-title">Confirm Action</h3>
                <p style="color:#aaa; font-size:14px;" id="conf-msg">Are you sure?</p>
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button class="admin-btn btn-ghost" style="flex:1" onclick="document.getElementById('admin-confirm-modal').style.display='none'">Cancel</button>
                    <button class="admin-btn btn-danger" style="flex:1" id="conf-yes-btn">Yes, Do It</button>
                </div>
            </div>
        </div>

        <div id="admin-mirror-modal" class="admin-modal-overlay" style="z-index:20001;">
            <div style="background:#111; width:350px; height:600px; border:2px solid var(--accent); border-radius:20px; position:relative; overflow:hidden; display:flex; flex-direction:column;">
                <div style="background:var(--accent); color:white; padding:10px; text-align:center; font-weight:bold;">
                    MIRRORING: <span id="mirror-name">User</span>
                </div>
                <div style="flex:1; padding:20px; overflow-y:auto; color:white;">
                    <div style="text-align:center;">
                        <img id="mirror-img" src="" style="width:80px; height:80px; border-radius:50%; margin-bottom:10px;">
                        <h3>Wallet: <span style="color:gold" id="mirror-wallet">0</span></h3>
                    </div>
                    <hr style="border-color:#333">
                    <p><strong>Bio:</strong> <span id="mirror-bio">...</span></p>
                    <p><strong>Email:</strong> <span id="mirror-email">...</span></p>
                    <div style="background:#222; padding:10px; border-radius:8px; margin-top:10px;">
                        <strong>Last Location:</strong><br>
                        Lat: 40.7128, Lng: -74.0060
                    </div>
                </div>
                <button onclick="document.getElementById('admin-mirror-modal').style.display='none'" style="width:100%; padding:15px; background:#333; color:white; border:none; cursor:pointer; font-weight:bold;">EXIT MIRROR SESSION</button>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, addDoc, query, where, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- 1. CONFIGURATION (REPLACE WITH YOUR KEYS IF TESTING STANDALONE) ---
        // Since you're integrating, you likely already have 'window.db' initialized.
        // We will assume window.db exists or try to init it.
        
        let db; 
        if (window.db) {
            db = window.db;
        } else {
            console.warn("Admin Module: 'window.db' not found. Ensure Firebase is initialized in home.html.");
        }

        // --- 2. ADMIN LOGIC CLASS ---
        class AdminController {
            constructor() {
                this.currentUser = null;
                this.crawlerInterval = null;
            }

            // --- INITIALIZATION ---
            init(user) {
                this.currentUser = user;
                // Check Firestore for isAdmin
                // For demo/standalone, we force show button
                document.getElementById('admin-entry-btn').style.display = 'flex'; 
                console.log("Admin Module Initialized");
            }

            togglePanel() {
                const p = document.getElementById('god-mode-panel');
                p.style.display = (p.style.display === 'flex') ? 'none' : 'flex';
                if(p.style.display === 'flex') this.switchTab('verify');
            }

            switchTab(tabId) {
                document.querySelectorAll('.admin-tab').forEach(t => t.style.display = 'none');
                document.querySelectorAll('.admin-nav-item').forEach(n => n.classList.remove('active'));
                
                document.getElementById('tab-' + tabId).style.display = 'block';
                // Highlight nav logic would go here
                
                if(tabId === 'verify') this.renderVerificationQueue();
                if(tabId === 'users') this.renderUserList();
                if(tabId === 'content') this.renderStreams();
            }

            // --- FEATURE 1: VERIFICATION CENTER ---
            async renderVerificationQueue() {
                const container = document.getElementById('verify-queue-container');
                container.innerHTML = '<p>Loading pending users...</p>';
                
                // MOCK DATA FOR DEMO (Replace with Firestore Query in Prod)
                // const q = query(collection(db, 'users'), where('status', '==', 'pending'));
                const mockQueue = [
                    { id: 'user_01', alias: 'Jessica_99', img: 'https://i.pravatar.cc/150?u=1', idCard: 'https://via.placeholder.com/300x200?text=GOV+ID', timestamp: '10:30 AM' },
                    { id: 'user_02', alias: 'Mike_T', img: 'https://i.pravatar.cc/150?u=2', idCard: 'https://via.placeholder.com/300x200?text=GOV+ID', timestamp: '11:15 AM' }
                ];

                document.getElementById('pending-badge').innerText = mockQueue.length;

                container.innerHTML = '';
                if(mockQueue.length === 0) container.innerHTML = '<p>No pending verifications.</p>';

                mockQueue.forEach(u => {
                    const card = document.createElement('div');
                    card.className = 'admin-card';
                    card.innerHTML = `
                        <div class="card-header">
                            <h3 class="card-title">${u.alias} <span style="font-size:12px; color:#666;">(${u.id})</span></h3>
                            <span>${u.timestamp}</span>
                        </div>
                        <div class="verify-grid">
                            <div class="evidence-box">
                                <img src="${u.img}">
                                <div class="evidence-label">LIVE SELFIE</div>
                            </div>
                            <div class="evidence-box">
                                <img src="${u.idCard}">
                                <div class="evidence-label">GOV ID</div>
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; margin-top:20px;">
                            <button class="admin-btn btn-success" style="flex:1; justify-content:center;" onclick="window.admin.verifyDecision('${u.id}', 'approve')">‚úÖ APPROVE</button>
                            <button class="admin-btn btn-danger" style="flex:1; justify-content:center;" onclick="window.admin.verifyDecision('${u.id}', 'deny')">üö´ DENY</button>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }

            verifyDecision(uid, decision) {
                const title = decision === 'approve' ? 'Approve User?' : 'Deny User?';
                const msg = decision === 'approve' 
                    ? "User will be Verified and sent a Welcome Email." 
                    : "User will be Rejected and sent a Rejection Email.";
                
                this.confirmAction(title, msg, () => {
                    // 1. UPDATE DB (Mock)
                    console.log(`DB Update: users/${uid} set status = ${decision === 'approve' ? 'verified' : 'rejected'}`);
                    
                    // 2. TRIGGER EMAIL (Mock)
                    const template = decision === 'approve' ? 'tmpl_welcome' : 'tmpl_rejected';
                    console.log(`EMAIL TRIGGER: Send ${template} to ${uid}`);
                    alert(`Action Complete. Auto-Email sent (${template}).`);
                    
                    this.renderVerificationQueue(); // Refresh
                });
            }

            // --- FEATURE 2 & 4: USER MANAGEMENT & WARNINGS ---
            async renderUserList() {
                const container = document.getElementById('users-list-container');
                // MOCK USERS
                const users = [
                    { id: 'u1', alias: 'BadGuy_404', isExplicit: true, subscriptionEnds: '2026-05-01' },
                    { id: 'u2', alias: 'GoodUser_22', isExplicit: false, subscriptionEnds: null }
                ];

                container.innerHTML = '';
                users.forEach(u => {
                    const row = document.createElement('div');
                    row.className = 'user-row';
                    
                    // EXPLICIT WARNING LOGIC
                    const warning = u.isExplicit ? `<div class="warning-tag">‚ö†Ô∏è EXPLICIT TAG</div>` : '';

                    row.innerHTML = `
                        <div style="display:flex; flex-direction:column;">
                            <span style="font-weight:bold; color:white;">${u.alias}</span>
                            <span style="font-size:10px; color:#666;">ID: ${u.id}</span>
                            ${warning}
                        </div>
                        <div style="display:flex; gap:5px;">
                            <button class="admin-btn btn-ghost" onclick="window.admin.mirrorUser('${u.id}')">ü™û Mirror</button>
                            <button class="admin-btn btn-danger" onclick="window.admin.sanctionUser('${u.id}', '${u.subscriptionEnds}')">‚ö° Ban</button>
                        </div>
                    `;
                    container.appendChild(row);
                });
            }

            mirrorUser(uid) {
                // Fetch user data (Mock)
                document.getElementById('mirror-name').innerText = "BadGuy_404";
                document.getElementById('mirror-wallet').innerText = "500";
                document.getElementById('mirror-bio').innerText = "I like risky stuff.";
                document.getElementById('mirror-email').innerText = "guy@example.com";
                document.getElementById('mirror-img').src = "https://i.pravatar.cc/150?u=1";
                
                document.getElementById('admin-mirror-modal').style.display = 'flex';
            }

            sanctionUser(uid, subEnd) {
                // CHECK DEFERRED BAN OPTION
                if (subEnd && subEnd !== 'null') {
                    this.confirmAction("Paying User Detected", `User has a subscription ending ${subEnd}. Select Ban Type:`, () => {
                        // Logic for immediate ban
                        console.log("Immediate Ban Executed");
                    });
                    // In a real UI, I'd add a third button here for "Defer Ban", 
                    // but for this demo, we'll just show the logic is aware.
                    alert(`OPTIONS:\n1. Immediate Ban\n2. Defer Ban until ${subEnd}`);
                } else {
                    this.confirmAction("Ban User", "Permanently block this account?", () => {
                        console.log("Banned " + uid);
                        alert("User Banned.");
                    });
                }
            }

            // --- FEATURE 3: PUBLIC CRAWLER ---
            runCrawlerOnce() {
                const log = document.getElementById('crawler-output');
                log.innerHTML += `<br>> Starting Scan...`;
                
                // MOCK SCANNING
                setTimeout(() => {
                    const hits = [
                        { user: 'Dealer_X', field: 'Bio', match: 'contact 555-0199 for stuff' },
                        { user: 'Bot_99', field: 'Alias', match: 'Insta_Link_Here' }
                    ];

                    hits.forEach(h => {
                        log.innerHTML += `<br><span class="log-hit">[HIT] ${h.user} (${h.field}): Found "${h.match}"</span>`;
                    });
                    log.innerHTML += `<br>> Scan Complete. Found ${hits.length} issues.`;
                    log.scrollTop = log.scrollHeight;
                }, 1000);
            }

            toggleAutoCrawler(checkbox) {
                if(checkbox.checked) {
                    this.crawlerInterval = setInterval(() => this.runCrawlerOnce(), 10000); // 10s for demo
                    alert("Auto-Crawler ON (Running every 10s)");
                } else {
                    clearInterval(this.crawlerInterval);
                    alert("Auto-Crawler OFF");
                }
            }

            // --- FEATURE 5: ECONOMY ---
            modCoins(action) {
                const uid = document.getElementById('robin-target').value;
                if(!uid) return alert("Enter UID");
                
                this.confirmAction(`${action.toUpperCase()} Coins?`, `Modify wallet for ${uid}?`, () => {
                    console.log(`${action} 100 coins for ${uid}`);
                    alert("Transaction Confirmed.");
                });
            }

            // --- FEATURE 6: CONTENT POLICING ---
            renderStreams() {
                const grid = document.getElementById('stream-monitor-grid');
                grid.innerHTML = '';
                // Mock Streams
                [1,2,3].forEach(i => {
                    const div = document.createElement('div');
                    div.className = 'stream-thumb';
                    div.innerHTML = `
                        <img src="https://via.placeholder.com/150x250?text=LIVE+${i}" style="width:100%;height:100%;object-fit:cover;">
                        <button class="kill-btn" onclick="window.admin.killStream('s_${i}')">√ó</button>
                    `;
                    grid.appendChild(div);
                });
            }

            killStream(sid) {
                this.confirmAction("Kill Stream?", "Force stop this broadcast?", () => {
                    console.log("Killed stream " + sid);
                    this.renderStreams(); // refresh
                });
            }

            nukeChat() {
                this.confirmAction("‚ò¢Ô∏è NUKE CHAT", "Permanently delete ALL public chat history?", () => {
                    console.log("Chat Wiped.");
                    alert("Public Chat has been reset.");
                });
            }

            flushBots() {
                this.confirmAction("Flush Bots", "Delete all users marked as 'Bot-Generated'?", () => {
                    console.log("Bots Flushed.");
                    alert("Database cleaned.");
                });
            }

            // --- SYSTEM UTILS ---
            toggleMaintenance() {
                const isOn = document.getElementById('maint-toggle').checked;
                // In prod, this sets a flag in /system/status doc
                alert(`Maintenance Mode: ${isOn ? 'ON (Users Locked Out)' : 'OFF'}`);
            }

            sendBroadcast() {
                const msg = document.getElementById('broadcast-msg').value;
                if(msg) alert(`Broadcast Sent: "${msg}"`);
            }

            // --- GENERIC CONFIRMATION HELPER ---
            confirmAction(title, message, onYes) {
                document.getElementById('conf-title').innerText = title;
                document.getElementById('conf-msg').innerText = message;
                document.getElementById('admin-confirm-modal').style.display = 'flex';
                
                const yesBtn = document.getElementById('conf-yes-btn');
                // Remove old listeners to prevent stacking
                const newBtn = yesBtn.cloneNode(true);
                yesBtn.parentNode.replaceChild(newBtn, yesBtn);
                
                newBtn.onclick = () => {
                    document.getElementById('admin-confirm-modal').style.display = 'none';
                    onYes();
                };
            }
        }

        // --- 3. EXPOSE TO WINDOW ---
        window.admin = new AdminController();
        window.admin.init(); // Initialize logic

    </script>
</body>
</html>
