<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Split Editor</title>
    <style>
        /* Base Setup */
        body { 
            margin: 0; 
            padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            height: 95vh; 
            overflow: hidden; 
            display: flex; /* Horizontal Layout */
            background: #1e1e1e;
        }

        /* 1. LEFT SIDE: EDITOR */
        #editor-pane {
            width: 40%; /* Initial Width */
            min-width: 200px;
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
            border-right: 1px solid #333;
        }

        /* Header */
        #header {
            padding: 10px 15px;
            background: #252526;
            color: #ccc;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #333;
        }

        /* Code Area */
        #code-display {
            flex-grow: 1;
            background: #1e1e1e;
            color: #9cdcfe;
            border: none;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
            line-height: 1.5;
        }

        /* Input Area */
        #input-area {
            padding: 15px;
            background: #252526;
            border-top: 1px solid #333;
            display: flex;
            gap: 10px;
        }
        input {
            flex-grow: 1;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #3c3c3c;
            color: white;
            outline: none;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:disabled { background: #555; }

        /* 2. THE RESIZER HANDLE (The draggable bar) */
        #resizer {
            width: 8px;
            background: #333;
            cursor: col-resize;
            transition: background 0.2s;
            z-index: 10;
        }
        #resizer:hover { background: #007bff; }

        /* 3. RIGHT SIDE: PREVIEW */
        #preview-pane {
            flex-grow: 1; /* Takes remaining space */
            background: white;
            position: relative;
            min-width: 200px;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        /* Helper to prevent mouse getting stuck in iframe during drag */
        .dragging iframe { pointer-events: none; }

        /* Loading Overlay */
        #loading { display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.5); color: white; justify-content: center; align-items: center; z-index: 20; backdrop-filter: blur(2px); }

    </style>
</head>
<body>

    <div id="editor-pane" style="width: 40%;"> <div id="header">
            <span>AI Editor</span>
            <span style="opacity: 0.5">Gemini Flash</span>
        </div>
        <textarea id="code-display" spellcheck="false"></textarea>
        
        <form id="input-area" onsubmit="event.preventDefault(); runAI()">
            <input type="text" id="prompt" placeholder="Type a change..." autocomplete="off">
            <button type="submit" id="build-btn">Build</button>
        </form>
    </div>

    <div id="resizer"></div>

    <div id="preview-pane">
        <iframe id="live-preview"></iframe>
        <div id="loading">Generating Code...</div>
    </div>

    <script>
        // --- API KEY ---
        const API_KEY = 'AIzaSyCEGVWdL98Wm-PZrEChnco8Sio5SkE8Uhw';
        // ---------------

        // Elements
        const editorPane = document.getElementById('editor-pane');
        const resizer = document.getElementById('resizer');
        const previewPane = document.getElementById('preview-pane');
        const codeDisplay = document.getElementById('code-display');
        const previewFrame = document.getElementById('live-preview');
        const buildBtn = document.getElementById('build-btn');
        const promptInput = document.getElementById('prompt');
        const loading = document.getElementById('loading');

        // ============================
        //  DRAG RESIZING LOGIC
        // ============================
        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.body.style.cursor = 'col-resize';
            previewPane.classList.add('dragging'); // Disables iframe pointer events
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            
            // Calculate percentage width based on mouse X position
            const newWidth = (e.clientX / window.innerWidth) * 100;
            
            // Limit range (min 10%, max 90%)
            if(newWidth > 10 && newWidth < 90) {
                editorPane.style.width = newWidth + '%';
            }
        });

        document.addEventListener('mouseup', () => {
            if(isResizing) {
                isResizing = false;
                document.body.style.cursor = 'default';
                previewPane.classList.remove('dragging'); // Re-enable iframe
            }
        });

        // ============================
        //  AI LOGIC
        // ============================
        let currentCode = `<!DOCTYPE html>
<html>
<head>
<style>
  body { font-family: sans-serif; margin: 0; height: 100vh; display: flex; align-items: center; justify-content: center; background: #f0f2f5; }
  .box { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; }
  h1 { color: #333; }
  button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-top: 15px;}
</style>
</head>
<body>
  <div class="box">
    <h1>Split View Ready</h1>
    <p>Drag the dark bar in the middle to resize me!</p>
    <button>Click Me</button>
  </div>
</body>
</html>`;

        updatePreview(currentCode);

        function updatePreview(html) {
            currentCode = html;
            codeDisplay.value = html;
            previewFrame.srcdoc = html;
        }

        async function runAI() {
            const userRequest = promptInput.value.trim();
            if(!userRequest) return;
            
            // UI Update
            promptInput.blur();
            buildBtn.disabled = true;
            buildBtn.innerText = "...";
            loading.style.display = 'flex';

            const fullPrompt = `
                Role: Web Developer.
                Task: Update HTML based on request: "${userRequest}".
                Constraint: Return ONLY raw HTML. No markdown.
                Current Code:
                ${currentCode}
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: fullPrompt }] }] })
                });

                const data = await response.json();
                
                if(data.error) {
                    alert("Error: " + data.error.message);
                } else {
                    let aiCode = data.candidates[0].content.parts[0].text;
                    aiCode = aiCode.replace(/```html/g, '').replace(/```/g, '').trim();
                    updatePreview(aiCode);
                    promptInput.value = '';
                }
            } catch (err) {
                alert("Network Error");
            }

            buildBtn.disabled = false;
            buildBtn.innerText = "Build";
            loading.style.display = 'none';
        }

        // Sync manual edits
        codeDisplay.addEventListener('input', (e) => {
            currentCode = e.target.value;
            previewFrame.srcdoc = e.target.value;
        });

    </script>
</body>
</html>

